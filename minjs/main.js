function Particle(t){this.x=0,this.y=0,this.xVelocity=0,this.yVelocity=0,this.radius=5,this.context=t,this.draw=function(){return this.image?void this.context.drawImage(this.image,this.x-128,this.y-128):(this.context.beginPath(),this.context.arc(this.x,this.y,this.radius,0,2*Math.PI,!1),this.context.fillStyle="rgba(0, 255, 255, 1)",this.context.fill(),void this.context.closePath())},this.update=function(){this.x+=this.xVelocity,this.y+=this.yVelocity,this.x>=canvasWidth?(this.xVelocity=-this.xVelocity,this.x=canvasWidth):this.x<=0&&(this.xVelocity=-this.xVelocity,this.x=0),this.y>=canvasHeight?(this.yVelocity=-this.yVelocity,this.y=canvasHeight):this.y<=0&&(this.yVelocity=-this.yVelocity,this.y=0)},this.setPosition=function(t,i){this.x=t,this.y=i},this.setVelocity=function(t,i){this.xVelocity=t,this.yVelocity=i},this.setImage=function(t){this.image=t}}function generateRandom(t,i){return Math.random()*(i-t)+t}function init(){var t=document.getElementById("myCanvas");if(t.getContext){context=t.getContext("2d");for(var i=0;particleCount>i;++i){var e=new Particle(context);e.setPosition(generateRandom(0,canvasWidth),generateRandom(0,canvasHeight)),e.setVelocity(generateRandom(-maxVelocity,maxVelocity),generateRandom(-maxVelocity,maxVelocity)),particles.push(e)}}else alert("Please use a modern browser")}function draw(){context.fillStyle="rgba(0, 0, 0, 0.5)",context.fillRect(0,0,1680,330),particles.forEach(function(t){t.draw()})}function update(){particles.forEach(function(t){t.update()})}var particles=[],particleCount=160,maxVelocity=1,targetFPS=60,canvasWidth=1680,canvasHeight=200,imageObj=new Image;imageObj.onload=function(){particles.forEach(function(t){t.setImage(imageObj)})},imageObj.src="http://www.blog.jonnycornwell.com/wp-content/uploads/2012/07/Smoke10.png";var context;init(),context&&setInterval(function(){update(),draw()},1e3/targetFPS);var canvasLightning=function(t,i,e){this.init=function(){this.loop()};var n=this;this.c=t,this.ctx=t.getContext("2d"),this.cw=i,this.ch=e,this.mx=0,this.my=0,this.lightning=[],this.lightTimeCurrent=0,this.lightTimeTotal=50,this.rand=function(t,i){return~~(Math.random()*(i-t+1)+t)},this.hitTest=function(t,i,e,n,a,o,s,c){return!(a>t+e||t>a+s||o>i+n||i>o+c)},this.clearCanvas=function(){this.ctx.globalCompositeOperation="destination-out",this.ctx.fillStyle="rgba(0,0,0,"+this.rand(1,15)/150+")",this.ctx.fillRect(0,0,this.cw,this.ch),this.ctx.globalCompositeOperation="source-over"},this.loop=function(){var t=function(){requestAnimationFrame(t,n.c),n.clearCanvas()};t()}},isCanvasSupported=function(){var t=document.createElement("canvas");return!(!t.getContext||!t.getContext("2d"))},setupRAF=function(){for(var t=0,i=["ms","moz","webkit","o"],e=0;e<i.length&&!window.requestAnimationFrame;++e)window.requestAnimationFrame=window[i[e]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[i[e]+"CancelAnimationFrame"]||window[i[e]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(i,e){var n=(new Date).getTime(),a=Math.max(0,16-(n-t)),o=window.setTimeout(function(){i(n+a)},a);return t=n+a,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})};$(window).load(function(){if(isCanvasSupported){var t=document.getElementById("myCanvas"),i=t.width=window.innerWidth,e=t.height=window.innerHeight,n=new canvasLightning(t,i,e);setupRAF(),n.init()}});